{% extends "GGshopping.html" %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/login.css' %}">
{% endblock head %}

{% block content %}
<div class="login-container">

    {% if messages %}
      {% for message in messages %}
        <div class="msg {{ message.tags }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- ================= 登入 ================= -->
    <div id="loginBox" class="form-box active">
        <h1 class="login-title">登入</h1>

       <form method="post" action="{% url 'login' %}">
            {% csrf_token %}

            <input
                class="login-input"
                type="text"
                name="account"
                placeholder="請輸入帳號"
                required
            >

            <input
                class="login-input"
                type="password"
                name="password"
                placeholder="請輸入密碼（至少6位）"
                minlength="6"
                required
            >

            <button class="login-btn" type="submit">
                登入
            </button>
        </form>

        <div class="forgot-password" onclick="switchToForgot()">
            忘記密碼？
        </div>

        <div class="divider">或使用社群帳號登入</div>

        <div class="social-login">
            <button class="social-btn line" type="button">
                <img src="{% static 'icons/line.svg' %}">
            </button>
            <button class="social-btn" type="button">
                <img src="{% static 'icons/google.svg' %}">
            </button>
        </div>

        <div class="register-section">
            <h3>還不是會員？</h3>
            <button class="register-btn" type="button" onclick="switchToRegister()">
                註冊會員
            </button>
        </div>
    </div>

    <!-- ================= 註冊 ================= -->
    <div id="registerBox" class="form-box">

        <!-- 註冊 Step 1 -->
        <div id="registerStep1" class="form-step active">
            <h1 class="login-title">註冊會員</h1>

            <input class="login-input" type="text" id="regPhone" placeholder="手機號碼" required>
            <input class="login-input" type="email" id="regEmail" placeholder="Email" required>

            <button class="login-btn" type="button" onclick="goRegisterStep2()">
                下一步
            </button>

            <div class="register-section">
                <h3>已經有帳號？</h3>
                <button class="register-btn" type="button" onclick="switchToLogin()">
                    登入
                </button>
            </div>
        </div>

        <!-- 註冊 Step 2 -->
        <div id="registerStep2" class="form-step">
            <h1 class="login-title">驗證與設定密碼</h1>

            <form method="post" action="{% url 'confirm_register' %}">
                {% csrf_token %}
                <input class="login-input" name="code" placeholder="驗證碼" required>
                <input class="login-input" name="password" type="password" placeholder="設定密碼(至少6位數)" minlength="6" required>
                <input class="login-input" name="password2" type="password" placeholder="確認密碼(至少6位數)" minlength="6" required>

                <button class="login-btn" type="submit">完成註冊</button>
            </form>

            <div class="helper-text">
                <span id="countdown">60</span> 秒後可重新發送
                <span id="resend" style="display:none;" onclick="resendCode()">重新發送</span>
            </div>
        </div>
    </div>

    <!-- ================= 忘記密碼 ================= -->
    <div id="forgotBox" class="form-box">

        <!-- 忘記密碼 Step 1 -->
        <div id="forgotStep1" class="form-step active">
            <h1 class="login-title">忘記密碼</h1>

            <input class="login-input" id="forgotAccount" placeholder="請輸入 Email 或手機">

            <button class="login-btn" type="button" onclick="goForgotStep2()">
                發送驗證碼
            </button>

            <div class="forgot-password" onclick="switchToLogin()">
                ← 返回登入
            </div>
        </div>

        <!-- 忘記密碼 Step 2 -->
        <div id="forgotStep2" class="form-step">
            <h1 class="login-title">重設密碼</h1>

            <form method="post" action="{% url 'forgot_confirm' %}">
                {% csrf_token %}
                <input class="login-input" name="code" placeholder="驗證碼" required>
                <input class="login-input" name="password" type="password" placeholder="新密碼" minlength="6" required>
                <input class="login-input" name="password2" type="password" placeholder="確認新密碼" minlength="6" required>

                <button class="login-btn" type="submit">
                    重設密碼
                </button>
            </form>

            <div class="helper-text">
                <span id="forgotCountdown">60</span> 秒後可重新發送
                <span id="forgotResend" style="display:none;" onclick="resendForgotCode()">重新發送</span>
            </div>
        </div>
    </div>

</div>

{% endblock content %}
{% block extra_js %}
<meta name="csrf-token" content="{{ csrf_token }}">
<script src="{% static 'js/login.js' %}"></script>
{% endblock %}

